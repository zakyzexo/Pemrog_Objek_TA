{% extends "base.html" %}
{% block title %}Kelola Menu{% endblock %}

{% block content %}
<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Daftar Menu</h3>
    <a href="{% url 'tambah_menu' %}" class="btn btn-success">+ Tambah Menu</a>
  </div>

  <div class="row g-3">
    {% for item in menu_list %}
      <div class="col-md-4">
        <div class="card p-3 h-100">
          <div class="d-flex">
            <div class="flex-grow-1">
              <h5>{{ item.nama_makanan }}</h5>
              <p class="small text-muted mb-1">{{ item.deskripsi|truncatechars:70 }}</p>
              <div class="fw-bold text-success">Rp {{ item.harga }}</div>
            </div>
            <div class="ms-2">
              {% if item.foto_makanan %}
                <img src="{{ item.foto_makanan.url }}" alt="" style="width:80px;height:70px;object-fit:cover;border-radius:8px;">
              {% endif %}
            </div>
          </div>
          <div class="mt-3 d-flex justify-content-between">
            <div>
              {% if item.status == 'available' %}
                <span class="badge bg-success">Tersedia</span>
              {% else %}
                <span class="badge bg-danger">Habis</span>
              {% endif %}
            </div>
            <div>
              <a href="{% url 'edit_menu' item.id %}" class="btn btn-sm btn-outline-primary">Edit</a>
              <button class="btn btn-sm btn-outline-danger" onclick="confirmDelete({{ item.id }})">Hapus</button>

              <form id="form-delete-{{ item.id }}" action="{% url 'hapus_menu' item.id %}" method="POST" style="display:none;">
                {% csrf_token %}
              </form>
            </div>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12">
        <div class="card p-4 text-center">Belum ada menu.</div>
      </div>
    {% endfor %}
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
function confirmDelete(id){
  Swal.fire({
    title: 'Yakin hapus menu?',
    text: "Tindakan ini tidak dapat dibatalkan.",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Hapus',
    cancelButtonText: 'Batal'
  }).then((res) => {
    if(res.isConfirmed){
      document.getElementById('form-delete-' + id).submit();
    }
  });
}
</script>
{% endblock %}
