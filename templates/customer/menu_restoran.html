{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ resto.nama_restoran }} - Menu</title>

    <!-- Bootstrap 5 -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
    />

    <style>
        body {
            background: #f8f9fa;
        }

        .menu-card {
            transition: 0.2s;
            border-radius: 12px;
            overflow: hidden;
        }

        .menu-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 18px rgba(0,0,0,0.1);
        }

        .menu-img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .badge-status {
            font-size: 0.85rem;
        }
    </style>
</head>
<body>

<div class="container py-4">

    <!-- Header -->
    <div class="text-center mb-4">
        {% if resto.foto_logo %}
        <img src="{{ resto.foto_logo.url }}" style="width: 90px; height: 90px; border-radius: 50%; object-fit: cover;">
        {% endif %}
        <h1 class="mt-3">{{ resto.nama_restoran }}</h1>
        <p class="text-muted">{{ resto.deskripsi }}</p>
        <hr>
    </div>

    <h3 class="mb-3">Daftar Menu</h3>

    <!-- Menu Grid -->
    <div class="row">
        {% for menu in menu_list %}
        <div class="col-md-4 mb-4">
            <div class="card menu-card shadow-sm">

                {% if menu.foto_makanan %}
                <img src="{{ menu.foto_makanan.url }}" class="menu-img">
                {% else %}
                <img src="https://via.placeholder.com/300x180?text=No+Image" class="menu-img">
                {% endif %}

                <div class="card-body">
                    <h5>{{ menu.nama_makanan }}</h5>
                    <p class="text-muted small">{{ menu.deskripsi|truncatechars:80 }}</p>
                    <h6 class="fw-bold text-success">Rp {{ menu.harga }}</h6>

                    {% if menu.status == 'available' %}
                    <span class="badge bg-success badge-status">Tersedia</span>
                    {% else %}
                    <span class="badge bg-danger badge-status">Habis</span>
                    {% endif %}

                    <br><br>

                    {% if menu.status == 'available' %}
                    <button
                        class="btn btn-primary w-100"
                        onclick="openModal('{{ menu.id }}','{{ menu.nama_makanan }}','{{ menu.harga }}')"
                    >
                        Tambah ke Keranjang
                    </button>
                    {% else %}
                    <button class="btn btn-secondary w-100" disabled>Habis</button>
                    {% endif %}
                </div>

            </div>
        </div>
        {% empty %}
        <p class="text-center">Belum ada menu.</p>
        {% endfor %}
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="cartModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="modalNama"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p>Harga: <strong id="modalHarga"></strong></p>

        <label class="form-label">Jumlah:</label>
        <input type="number" id="modalQty" class="form-control" value="1" min="1">

        <input type="hidden" id="modalMenuId">
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button class="btn btn-primary" onclick="submitCart()">Tambah ke Keranjang</button>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
let modal = new bootstrap.Modal(document.getElementById("cartModal"));

function openModal(id, nama, harga) {
    document.getElementById("modalMenuId").value = id;
    document.getElementById("modalNama").innerHTML = nama;
    document.getElementById("modalHarga").innerHTML = "Rp " + harga;
    modal.show();
}

function submitCart() {
    const menuId = document.getElementById("modalMenuId").value;
    const qty = document.getElementById("modalQty").value;
    const csrfToken = "{{ csrf_token }}";

    const form = document.createElement("form");
    form.method = "POST";
    form.action = `/restaurant/cart/add/${menuId}/`;

    form.innerHTML = `
        <input type="hidden" name="csrfmiddlewaretoken" value="${csrfToken}">
        <input type="hidden" name="qty" value="${qty}">
    `;

    document.body.appendChild(form);
    form.submit();
}
</script>

</body>
</html>
